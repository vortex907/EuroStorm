scripted_gui = {
	view_GDP = {
		context_type = player_context
		parent_window_token = top_bar
		window_name = "view_GDP_container"
		dirty = show_GDP_main

		visible = {
			is_ai = no
		}

		effects = {
			view_GDP_button_click = {
				if = {
					limit = { has_variable = show_GDP_main }
					clear_variable = show_GDP_main
				}
				else = {
					set_variable = { show_GDP_main = 1 }
				}
				clear_array = global.GDP_list_array
				every_country = {
					if = {
						limit = {
							NOT = { is_in_array = { global.GDP_list_array = THIS } }
						}
						add_to_array = { global.GDP_list_array = THIS }
						calculate_GDP = yes
					}
				}
				clear_array = GDP_selected_country_array
				add_to_array = { GDP_selected_country_array = THIS }
				update_position = yes
				calculate_region_GDP = yes
				calculate_faction_GDP = yes
				# Graph calculation
				calculate_gdp = yes
				compute_y_axis_intervals = yes
				sGDPui_add_point_to_graph = yes
			}
		}
	}

	GDP_main = {
		context_type = player_context
		parent_window_token = top_bar
		window_name = "GDP_main_container"
		dirty = show_GDP_main

		visible = {
			has_variable = show_GDP_main
		}

		dynamic_lists = {
			top_ten_GDP_grid = {
				array = global.top_ten_GDP_array
				change_scope = yes
				entry_container = top_ten_GDP_entry
			}
			GDP_list_grid = {
				array = global.GDP_list_array
				change_scope = yes
				entry_container = GDP_list_entry
			}
			GDP_selected_country_grid = {
				array = GDP_selected_country_array
				change_scope = yes
				entry_container = GDP_selected_country_entry
			}
			GDP_faction_list_grid = {
				array = global.GDP_faction_array
				change_scope = yes
				entry_container = GDP_faction_entry
			}
			GDP_region_list_grid = {
				array = global.GDP_region_array
				change_scope = no
				entry_container = GDP_region_entry
			}
			gdp_line_segments = {
				array = sGDPui_graph_offsets
				change_scope = no
				entry_container = sGDPui_graph_line_segment
				index = segment_idx
			}
		}

		effects = {
			GDP_list_sort_button_click = {
				create_GDP_sorted_array = yes
				add_to_variable = { show_GDP_main = 1 }
			}
			GDP_per_capita_list_sort_button_click = {
				create_GDP_per_capita_sorted_array = yes
				add_to_variable = { show_GDP_main = 1 }
			}
			GDP_list_flag_button_click = {
				ROOT = {
					clear_array = GDP_selected_country_array
					add_to_array = { GDP_selected_country_array = PREV }
					add_to_variable = { show_GDP_main = 1 }
				}
			}
			close_GDP_button_click = {
				clear_variable = show_GDP_main
			}
		}

		properties = {
			GDP_list_flag_button = {
				image = "[THIS.GetFlag]"
			}
			GDP_selected_country_flag_icon = {
				image = "[THIS.GetFlag]"
			}
			top_ten_GDP_country_flag_icon = {
				image = "[THIS.GetFlag]"
			}
			segment = {
				y = sGDPui_graph_offsets^segment_idx
				frame = sGDPui_graph_slopes^segment_idx
			}
		}
	}
}
